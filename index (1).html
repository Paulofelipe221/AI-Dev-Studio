<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CodeMind AI ‚Äî Dev Studio</title>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg:       #060810;
      --surface:  #0d1117;
      --panel:    #111827;
      --border:   #1f2d3d;
      --accent:   #00e5ff;
      --accent2:  #7c3aed;
      --green:    #00ff88;
      --red:      #ff4466;
      --yellow:   #ffd700;
      --text:     #c9d1d9;
      --dim:      #4a5568;
      --glow:     0 0 20px rgba(0,229,255,.25);
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'JetBrains Mono', monospace;
      min-height: 100vh;
      overflow: hidden;
    }

    /* === SCANLINES OVERLAY === */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0,0,0,.07) 2px,
        rgba(0,0,0,.07) 4px
      );
      pointer-events: none;
      z-index: 9999;
    }

    /* === NOISE BG === */
    body::after {
      content: '';
      position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.03'/%3E%3C/svg%3E");
      pointer-events: none;
      opacity: .4;
      z-index: 9998;
    }

    /* ===================== HEADER ===================== */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 24px;
      border-bottom: 1px solid var(--border);
      background: rgba(13,17,23,.9);
      backdrop-filter: blur(12px);
      position: relative;
      z-index: 100;
    }
    .logo {
      font-family: 'Syne', sans-serif;
      font-weight: 800;
      font-size: 1.4rem;
      color: #fff;
      letter-spacing: -1px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-icon {
      width: 32px; height: 32px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 8px;
      display: grid;
      place-items: center;
      font-size: .8rem;
      color: #fff;
      font-weight: 700;
    }
    .logo span { color: var(--accent); }

    .header-badge {
      font-size: .65rem;
      padding: 3px 10px;
      border-radius: 20px;
      border: 1px solid var(--accent);
      color: var(--accent);
      animation: pulse-border 2s infinite;
    }
    @keyframes pulse-border {
      0%,100%{ box-shadow:none; }
      50%{ box-shadow: var(--glow); }
    }

    .api-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .api-row input {
      background: var(--panel);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 6px 12px;
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: .7rem;
      width: 280px;
      transition: border .2s;
    }
    .api-row input:focus { outline: none; border-color: var(--accent); box-shadow: var(--glow); }
    .status-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--dim);
    }
    .status-dot.active { background: var(--green); box-shadow: 0 0 8px var(--green); }

    /* ===================== MAIN LAYOUT ===================== */
    .workspace {
      display: grid;
      grid-template-columns: 340px 1fr 380px;
      height: calc(100vh - 57px);
      overflow: hidden;
    }

    /* ===================== SIDEBAR LEFT ===================== */
    .sidebar-left {
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: var(--surface);
    }
    .sidebar-tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
    }
    .tab-btn {
      flex: 1;
      padding: 10px 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: .65rem;
      background: none;
      border: none;
      color: var(--dim);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all .2s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }
    .tab-btn:hover { color: var(--text); }

    .tab-panel { display: none; flex-direction: column; flex: 1; overflow: hidden; }
    .tab-panel.active { display: flex; }

    /* Tools list */
    .tools-list { overflow-y: auto; padding: 12px; flex: 1; }
    .tool-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      border: 1px solid transparent;
      margin-bottom: 6px;
      transition: all .2s;
    }
    .tool-item:hover { background: rgba(0,229,255,.06); border-color: rgba(0,229,255,.2); }
    .tool-item.active { background: rgba(0,229,255,.1); border-color: var(--accent); }
    .tool-icon {
      width: 32px; height: 32px;
      border-radius: 6px;
      display: grid;
      place-items: center;
      font-size: 1rem;
      flex-shrink: 0;
    }
    .tool-info { flex: 1; min-width: 0; }
    .tool-name { font-size: .72rem; font-weight: 600; color: #fff; margin-bottom: 2px; }
    .tool-desc { font-size: .6rem; color: var(--dim); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    /* File upload zone */
    .upload-zone {
      margin: 12px;
      border: 2px dashed var(--border);
      border-radius: 10px;
      padding: 24px 16px;
      text-align: center;
      cursor: pointer;
      transition: all .2s;
    }
    .upload-zone:hover, .upload-zone.drag-over {
      border-color: var(--accent);
      background: rgba(0,229,255,.05);
    }
    .upload-zone .icon { font-size: 2rem; margin-bottom: 8px; }
    .upload-zone p { font-size: .65rem; color: var(--dim); }
    .upload-zone strong { color: var(--accent); }
    #file-input { display: none; }

    .uploaded-files { padding: 0 12px 12px; overflow-y: auto; flex: 1; }
    .file-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      background: var(--panel);
      border-radius: 6px;
      margin-bottom: 6px;
      font-size: .65rem;
      border: 1px solid var(--border);
    }
    .file-badge .remove { margin-left: auto; cursor: pointer; color: var(--red); opacity: .6; }
    .file-badge .remove:hover { opacity: 1; }

    /* ===================== MAIN CENTER ===================== */
    .main-center {
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: var(--bg);
    }
    .center-toolbar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-bottom: 1px solid var(--border);
      background: var(--surface);
      flex-wrap: wrap;
    }
    .view-toggle {
      display: flex;
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
    }
    .view-btn {
      padding: 5px 12px;
      font-size: .65rem;
      background: none;
      border: none;
      color: var(--dim);
      cursor: pointer;
      font-family: 'JetBrains Mono', monospace;
      transition: all .2s;
    }
    .view-btn.active { background: var(--accent); color: #000; font-weight: 700; }

    .btn {
      padding: 6px 14px;
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: .68rem;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all .2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-primary { background: var(--accent); color: #000; }
    .btn-primary:hover { background: #00c8e0; transform: translateY(-1px); box-shadow: var(--glow); }
    .btn-secondary { background: var(--panel); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
    .btn-danger { background: rgba(255,68,102,.15); color: var(--red); border: 1px solid rgba(255,68,102,.3); }
    .btn-danger:hover { background: rgba(255,68,102,.25); }

    .spacer { flex: 1; }

    /* Code / Preview split */
    .output-area {
      display: flex;
      flex: 1;
      overflow: hidden;
      position: relative;
    }
    .code-pane, .preview-pane {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .code-pane {
      border-right: 1px solid var(--border);
    }
    .pane-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 14px;
      background: var(--panel);
      border-bottom: 1px solid var(--border);
      font-size: .65rem;
      color: var(--dim);
      flex-shrink: 0;
    }
    .pane-dots { display: flex; gap: 5px; }
    .dot { width: 10px; height: 10px; border-radius: 50%; }

    #code-editor {
      flex: 1;
      padding: 16px;
      background: transparent;
      color: #e2e8f0;
      font-family: 'JetBrains Mono', monospace;
      font-size: .75rem;
      line-height: 1.7;
      border: none;
      resize: none;
      outline: none;
      overflow-y: auto;
      white-space: pre;
      tab-size: 2;
    }
    #code-editor::placeholder { color: var(--dim); }

    #preview-iframe {
      flex: 1;
      width: 100%;
      background: white;
      border: none;
    }

    /* Split view */
    .output-area.split-view .code-pane,
    .output-area.split-view .preview-pane { flex: 1; }
    .output-area.code-only .preview-pane { display: none; }
    .output-area.preview-only .code-pane { display: none; }

    /* Loading overlay */
    .loading-overlay {
      position: absolute; inset: 0;
      background: rgba(6,8,16,.85);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 50;
      backdrop-filter: blur(4px);
    }
    .loading-overlay.active { display: flex; }
    .loader-ring {
      width: 56px; height: 56px;
      border-radius: 50%;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loader-text { font-size: .75rem; color: var(--accent); }
    .loader-step { font-size: .65rem; color: var(--dim); margin-top: 6px; }

    /* ===================== SIDEBAR RIGHT (CHAT) ===================== */
    .sidebar-right {
      border-left: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      background: var(--surface);
      overflow: hidden;
    }
    .chat-header {
      padding: 14px 16px 10px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }
    .chat-header-icon {
      width: 28px; height: 28px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 6px;
      display: grid;
      place-items: center;
      font-size: .75rem;
    }
    .chat-header-title { font-family: 'Syne', sans-serif; font-size: .9rem; color: #fff; font-weight: 700; }
    .chat-header-sub { font-size: .6rem; color: var(--dim); }

    #chat-log {
      flex: 1;
      overflow-y: auto;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    #chat-log::-webkit-scrollbar { width: 4px; }
    #chat-log::-webkit-scrollbar-track { background: transparent; }
    #chat-log::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

    .msg {
      max-width: 94%;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: .7rem;
      line-height: 1.7;
      animation: fadeUp .3s ease;
    }
    @keyframes fadeUp {
      from { opacity:0; transform: translateY(8px); }
      to   { opacity:1; transform: translateY(0); }
    }
    .msg-user {
      background: rgba(124,58,237,.2);
      border: 1px solid rgba(124,58,237,.3);
      align-self: flex-end;
      color: #d4b8ff;
    }
    .msg-ai {
      background: var(--panel);
      border: 1px solid var(--border);
      align-self: flex-start;
      color: var(--text);
    }
    .msg-ai .msg-label { color: var(--accent); font-weight: 700; font-size: .6rem; margin-bottom: 4px; }
    .msg-user .msg-label { color: #a78bfa; font-weight: 700; font-size: .6rem; margin-bottom: 4px; text-align: right; }
    .msg-system {
      background: rgba(0,255,136,.06);
      border: 1px solid rgba(0,255,136,.2);
      align-self: center;
      color: var(--green);
      font-size: .62rem;
      text-align: center;
    }
    .msg-error {
      background: rgba(255,68,102,.08);
      border: 1px solid rgba(255,68,102,.2);
      align-self: center;
      color: var(--red);
      font-size: .65rem;
    }

    .quick-actions {
      padding: 10px 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      border-top: 1px solid var(--border);
    }
    .quick-btn {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: .6rem;
      background: var(--panel);
      border: 1px solid var(--border);
      color: var(--dim);
      cursor: pointer;
      font-family: 'JetBrains Mono', monospace;
      transition: all .15s;
    }
    .quick-btn:hover { border-color: var(--accent); color: var(--accent); }

    .chat-input-area {
      padding: 12px 14px 14px;
      border-top: 1px solid var(--border);
      flex-shrink: 0;
    }
    .chat-input-wrap {
      display: flex;
      gap: 8px;
      align-items: flex-end;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 10px;
      transition: border .2s;
    }
    .chat-input-wrap:focus-within { border-color: var(--accent); box-shadow: var(--glow); }
    #user-input {
      flex: 1;
      background: none;
      border: none;
      color: var(--text);
      font-family: 'JetBrains Mono', monospace;
      font-size: .72rem;
      resize: none;
      outline: none;
      max-height: 120px;
      min-height: 20px;
      line-height: 1.5;
    }
    #user-input::placeholder { color: var(--dim); }
    .send-btn {
      width: 32px; height: 32px;
      background: var(--accent);
      border: none;
      border-radius: 7px;
      cursor: pointer;
      display: grid;
      place-items: center;
      flex-shrink: 0;
      transition: all .15s;
    }
    .send-btn:hover { background: #00c8e0; transform: scale(1.05); }
    .send-btn svg { width: 14px; height: 14px; fill: #000; }

    /* Mode select */
    .mode-select {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--dim);
      padding: 5px 8px;
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: .65rem;
      margin-bottom: 8px;
      outline: none;
      transition: border .2s;
    }
    .mode-select:focus { border-color: var(--accent); color: var(--text); }

    /* ===================== WELCOME SCREEN ===================== */
    #welcome {
      position: absolute; inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
      pointer-events: none;
    }
    .welcome-inner {
      text-align: center;
      max-width: 420px;
    }
    .welcome-logo {
      font-family: 'Syne', sans-serif;
      font-size: 2.2rem;
      font-weight: 800;
      color: #fff;
      margin-bottom: 8px;
    }
    .welcome-logo span { color: var(--accent); }
    .welcome-sub {
      font-size: .72rem;
      color: var(--dim);
      line-height: 1.8;
    }
    .welcome-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-top: 20px;
    }
    .welcome-chip {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: .65rem;
      border: 1px solid var(--border);
      color: var(--dim);
      background: var(--panel);
    }

    /* scrollbar global */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--dim); }

    /* Toast */
    #toast {
      position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
      background: var(--panel);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 20px;
      border-radius: 8px;
      font-size: .7rem;
      opacity: 0;
      transition: opacity .3s;
      z-index: 9999;
      pointer-events: none;
      max-width: 90vw;
      text-align: center;
    }
    #toast.show { opacity: 1; }
    #toast.success { border-color: var(--green); color: var(--green); }
    #toast.error { border-color: var(--red); color: var(--red); }
  </style>
</head>
<body>

<!-- ============ HEADER ============ -->
<header>
  <div class="logo">
    <div class="logo-icon">CM</div>
    Code<span>Mind</span> AI
    <div class="header-badge">BETA</div>
  </div>

  <div class="api-row">
    <div class="status-dot" id="status-dot"></div>
    <span style="font-size:.65rem;color:var(--dim)" id="status-label">Sem conex√£o</span>
    <input type="password" id="api-key" placeholder="Gemini API Key..." />
    <button class="btn btn-secondary" onclick="connectAPI()" style="font-size:.62rem;padding:5px 12px">Conectar</button>
  </div>
</header>

<!-- ============ WORKSPACE ============ -->
<div class="workspace">

  <!-- === SIDEBAR LEFT === -->
  <aside class="sidebar-left">
    <div class="sidebar-tabs">
      <button class="tab-btn active" onclick="switchTab('tools',this)">Ferramentas</button>
      <button class="tab-btn" onclick="switchTab('files',this)">Arquivos</button>
      <button class="tab-btn" onclick="switchTab('history',this)">Hist√≥rico</button>
    </div>

    <!-- TOOLS TAB -->
    <div class="tab-panel active" id="tab-tools">
      <div class="tools-list">
        <div class="tool-item active" onclick="selectTool(this,'build')">
          <div class="tool-icon" style="background:rgba(0,229,255,.15)">üöÄ</div>
          <div class="tool-info">
            <div class="tool-name">Construir Projeto</div>
            <div class="tool-desc">Crie do zero via descri√ß√£o</div>
          </div>
        </div>
        <div class="tool-item" onclick="selectTool(this,'fix')">
          <div class="tool-icon" style="background:rgba(255,68,102,.15)">üîß</div>
          <div class="tool-info">
            <div class="tool-name">Corrigir C√≥digo</div>
            <div class="tool-desc">Detecta e corrige bugs</div>
          </div>
        </div>
        <div class="tool-item" onclick="selectTool(this,'analyze')">
          <div class="tool-icon" style="background:rgba(255,215,0,.15)">üîç</div>
          <div class="tool-info">
            <div class="tool-name">Analisar C√≥digo</div>
            <div class="tool-desc">Revis√£o completa e melhorias</div>
          </div>
        </div>
        <div class="tool-item" onclick="selectTool(this,'refactor')">
          <div class="tool-icon" style="background:rgba(124,58,237,.15)">‚ú®</div>
          <div class="tool-info">
            <div class="tool-name">Refatorar</div>
            <div class="tool-desc">Limpa e otimiza o c√≥digo</div>
          </div>
        </div>
        <div class="tool-item" onclick="selectTool(this,'explain')">
          <div class="tool-icon" style="background:rgba(0,255,136,.15)">üìñ</div>
          <div class="tool-info">
            <div class="tool-name">Explicar C√≥digo</div>
            <div class="tool-desc">Linha a linha em PT-BR</div>
          </div>
        </div>
        <div class="tool-item" onclick="selectTool(this,'complete')">
          <div class="tool-icon" style="background:rgba(0,229,255,.15)">‚ö°</div>
          <div class="tool-info">
            <div class="tool-name">Auto-Completar</div>
            <div class="tool-desc">Finaliza c√≥digo incompleto</div>
          </div>
        </div>
        <div class="tool-item" onclick="selectTool(this,'convert')">
          <div class="tool-icon" style="background:rgba(255,165,0,.15)">üîÑ</div>
          <div class="tool-info">
            <div class="tool-name">Converter Linguagem</div>
            <div class="tool-desc">JS ‚Üí TS, Python ‚Üí JS, etc.</div>
          </div>
        </div>
        <div class="tool-item" onclick="selectTool(this,'docs')">
          <div class="tool-icon" style="background:rgba(100,200,255,.15)">üìù</div>
          <div class="tool-info">
            <div class="tool-name">Gerar Docs</div>
            <div class="tool-desc">README, JSDoc, coment√°rios</div>
          </div>
        </div>
      </div>
    </div>

    <!-- FILES TAB -->
    <div class="tab-panel" id="tab-files">
      <div class="upload-zone" id="drop-zone" onclick="document.getElementById('file-input').click()" ondragover="event.preventDefault();this.classList.add('drag-over')" ondragleave="this.classList.remove('drag-over')" ondrop="handleFileDrop(event)">
        <div class="icon">üìÇ</div>
        <p><strong>Clique ou arraste</strong> arquivos aqui</p>
        <p style="margin-top:6px">HTML, CSS, JS, TS, Python, etc.</p>
      </div>
      <input type="file" id="file-input" multiple accept=".html,.css,.js,.ts,.jsx,.tsx,.py,.php,.json,.md,.txt,.vue,.svelte" onchange="handleFileSelect(this)">
      <div class="uploaded-files" id="uploaded-files"></div>
    </div>

    <!-- HISTORY TAB -->
    <div class="tab-panel" id="tab-history">
      <div class="tools-list" id="history-list">
        <p style="font-size:.65rem;color:var(--dim);padding:12px">Nenhum hist√≥rico ainda. Comece a gerar c√≥digo!</p>
      </div>
    </div>
  </aside>

  <!-- === CENTER === -->
  <main class="main-center">
    <div class="center-toolbar">
      <div class="view-toggle">
        <button class="view-btn active" onclick="setView('split',this)">Split</button>
        <button class="view-btn" onclick="setView('code-only',this)">C√≥digo</button>
        <button class="view-btn" onclick="setView('preview-only',this)">Preview</button>
      </div>
      <button class="btn btn-secondary" onclick="copyCode()">üìã Copiar</button>
      <button class="btn btn-secondary" onclick="downloadCode()">üíæ Download</button>
      <button class="btn btn-secondary" onclick="formatCode()">üé® Formatar</button>
      <div class="spacer"></div>
      <button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è Limpar</button>
      <button class="btn btn-primary" onclick="runPreview()">‚ñ∂ Executar</button>
    </div>

    <div class="output-area split-view" id="output-area">
      <!-- Welcome -->
      <div id="welcome">
        <div class="welcome-inner">
          <div class="welcome-logo">Code<span>Mind</span></div>
          <p class="welcome-sub">IA completa para desenvolvedores.<br>Construa, corrija, analise e otimize<br>qualquer c√≥digo ou projeto.</p>
          <div class="welcome-chips">
            <span class="welcome-chip">üöÄ Gerar projetos completos</span>
            <span class="welcome-chip">üîß Corrigir bugs</span>
            <span class="welcome-chip">üîç Analisar c√≥digo</span>
            <span class="welcome-chip">üìù Gerar docs</span>
          </div>
        </div>
      </div>

      <!-- Loading -->
      <div class="loading-overlay" id="loading">
        <div class="loader-ring"></div>
        <div class="loader-text" id="loader-text">Processando...</div>
        <div class="loader-step" id="loader-step">Aguarde</div>
      </div>

      <!-- Code pane -->
      <div class="code-pane">
        <div class="pane-header">
          <div class="pane-dots">
            <div class="dot" style="background:#ff5f57"></div>
            <div class="dot" style="background:#febc2e"></div>
            <div class="dot" style="background:#28c840"></div>
          </div>
          <span id="code-lang">HTML / CSS / JS</span>
          <span id="code-lines">0 linhas</span>
        </div>
        <textarea id="code-editor" placeholder="// Seu c√≥digo aparecer√° aqui...&#10;// Use as ferramentas ou descreva o que quer criar no chat ‚Üí" oninput="updateLineCount()" spellcheck="false"></textarea>
      </div>

      <!-- Preview pane -->
      <div class="preview-pane">
        <div class="pane-header">
          <span>üåê Preview</span>
          <span id="preview-status">‚Äî</span>
          <button onclick="openInTab()" style="background:none;border:none;color:var(--dim);cursor:pointer;font-size:.65rem;font-family:'JetBrains Mono',monospace">‚Üó Nova aba</button>
        </div>
        <iframe id="preview-iframe" sandbox="allow-scripts allow-same-origin allow-forms allow-modals"></iframe>
      </div>
    </div>
  </main>

  <!-- === SIDEBAR RIGHT (CHAT) === -->
  <aside class="sidebar-right">
    <div class="chat-header">
      <div class="chat-header-icon">ü§ñ</div>
      <div>
        <div class="chat-header-title">CodeMind AI</div>
        <div class="chat-header-sub">Powered by Gemini 1.5 Pro</div>
      </div>
    </div>

    <div id="chat-log">
      <div class="msg msg-ai">
        <div class="msg-label">‚ñ≤ CODEMIND</div>
        Ol√°! Sou o <strong>CodeMind AI</strong>, seu assistente completo de desenvolvimento.<br><br>
        Posso <strong>criar projetos do zero</strong>, corrigir bugs, analisar c√≥digo, refatorar e muito mais.<br><br>
        Conecte sua API Key e me diga o que quer construir! üöÄ
      </div>
    </div>

    <div class="quick-actions">
      <button class="quick-btn" onclick="quickPrompt('Crie um site landing page profissional')">üåê Landing Page</button>
      <button class="quick-btn" onclick="quickPrompt('Crie um dashboard admin completo')">üìä Dashboard</button>
      <button class="quick-btn" onclick="quickPrompt('Crie um app de to-do list moderno')">‚úÖ To-Do App</button>
      <button class="quick-btn" onclick="quickPrompt('Corrija os erros no c√≥digo do editor')">üîß Corrigir</button>
      <button class="quick-btn" onclick="quickPrompt('Analise e melhore o c√≥digo no editor')">üîç Analisar</button>
      <button class="quick-btn" onclick="quickPrompt('Adicione responsividade ao c√≥digo')">üì± Responsivo</button>
    </div>

    <div class="chat-input-area">
      <select class="mode-select" id="mode-select">
        <option value="build">üöÄ Modo: Construir do zero</option>
        <option value="fix">üîß Modo: Corrigir bugs</option>
        <option value="analyze">üîç Modo: Analisar c√≥digo</option>
        <option value="refactor">‚ú® Modo: Refatorar</option>
        <option value="explain">üìñ Modo: Explicar c√≥digo</option>
        <option value="complete">‚ö° Modo: Auto-completar</option>
        <option value="convert">üîÑ Modo: Converter linguagem</option>
        <option value="docs">üìù Modo: Gerar documenta√ß√£o</option>
        <option value="chat">üí¨ Modo: Chat livre</option>
      </select>
      <div class="chat-input-wrap">
        <textarea id="user-input" placeholder="Descreva o que quer criar ou cole seu c√≥digo..." rows="2" onkeydown="handleKey(event)"></textarea>
        <button class="send-btn" onclick="sendMessage()">
          <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
      </div>
    </div>
  </aside>
</div>

<!-- Toast -->
<div id="toast"></div>

<script>
// ===================== STATE =====================
let apiKey = '';
let currentTool = 'build';
let uploadedFiles = [];
let codeHistory = [];
let isLoading = false;

// ===================== API CONNECTION =====================
function connectAPI() {
  const key = document.getElementById('api-key').value.trim();
  if (!key) return showToast('Insira uma API Key v√°lida', 'error');
  apiKey = key;
  document.getElementById('status-dot').classList.add('active');
  document.getElementById('status-label').textContent = 'Conectado';
  showToast('API Key conectada com sucesso!', 'success');
  addMessage('system', '‚úÖ API Key configurada. Pronto para gerar c√≥digo!');
}

// ===================== TOOLS =====================
function selectTool(el, tool) {
  document.querySelectorAll('.tool-item').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  currentTool = tool;
  document.getElementById('mode-select').value = tool;

  const labels = {
    build: 'üöÄ Construir do zero',
    fix: 'üîß Corrigir bugs',
    analyze: 'üîç Analisar c√≥digo',
    refactor: '‚ú® Refatorar',
    explain: 'üìñ Explicar c√≥digo',
    complete: '‚ö° Auto-completar',
    convert: 'üîÑ Converter linguagem',
    docs: 'üìù Gerar docs',
  };
  const input = document.getElementById('user-input');
  const hints = {
    build: 'Descreva o site ou app que quer criar...',
    fix: 'Descreva o problema ou cole o c√≥digo com bug...',
    analyze: 'Descreva o que quer analisar ou use o c√≥digo no editor...',
    refactor: 'Cole o c√≥digo que deseja refatorar...',
    explain: 'Cole o c√≥digo que quer entender...',
    complete: 'Cole o c√≥digo incompleto...',
    convert: 'Cole o c√≥digo e diga para qual linguagem converter...',
    docs: 'Cole o c√≥digo para gerar documenta√ß√£o...',
  };
  input.placeholder = hints[tool] || 'Digite sua mensagem...';
}

// ===================== SEND MESSAGE =====================
async function sendMessage() {
  if (!apiKey) return showToast('Conecte sua API Key primeiro!', 'error');
  if (isLoading) return;

  const userInput = document.getElementById('user-input');
  const prompt = userInput.value.trim();
  if (!prompt) return;

  const mode = document.getElementById('mode-select').value;
  userInput.value = '';

  addMessage('user', prompt);
  showLoading(true);

  try {
    const code = document.getElementById('code-editor').value;
    const filesContext = uploadedFiles.length > 0
      ? '\n\nARQUIVOS ENVIADOS PELO USU√ÅRIO:\n' + uploadedFiles.map(f => `--- ${f.name} ---\n${f.content}`).join('\n\n')
      : '';

    const systemPrompts = {
      build: `Voc√™ √© o CodeMind AI, um dev s√™nior especializado em criar sites e apps completos e 100% funcionais.
Gere APENAS c√≥digo HTML completo (com CSS e JS inline). Sem explica√ß√µes. C√≥digo profissional, responsivo e funcional.
Comece com <!DOCTYPE html>. Use design moderno e atraente. O c√≥digo deve funcionar sem depend√™ncias externas n√£o dispon√≠veis.`,

      fix: `Voc√™ √© o CodeMind AI, especialista em debug e corre√ß√£o de c√≥digo.
Se houver c√≥digo no editor, corrija-o. Retorne APENAS o c√≥digo HTML corrigido e funcional, come√ßando com <!DOCTYPE html>.
Liste no in√≠cio (coment√°rios HTML) os bugs encontrados e as corre√ß√µes feitas.`,

      analyze: `Voc√™ √© o CodeMind AI, revisor s√™nior de c√≥digo.
Analise o c√≥digo e forne√ßa um relat√≥rio detalhado EM PORTUGU√äS sobre:
1. Qualidade geral do c√≥digo
2. Bugs encontrados
3. Problemas de performance
4. Problemas de seguran√ßa
5. Boas pr√°ticas violadas
6. Sugest√µes de melhoria
Seja espec√≠fico e did√°tico.`,

      refactor: `Voc√™ √© o CodeMind AI, especialista em refatora√ß√£o.
Refatore o c√≥digo mantendo a funcionalidade mas melhorando: legibilidade, performance, organiza√ß√£o, boas pr√°ticas.
Retorne APENAS o c√≥digo HTML refatorado, come√ßando com <!DOCTYPE html>.`,

      explain: `Voc√™ √© o CodeMind AI, professor de programa√ß√£o.
Explique o c√≥digo EM PORTUGU√äS de forma clara e did√°tica, linha a linha quando necess√°rio.
Use exemplos e analogias para facilitar o entendimento.`,

      complete: `Voc√™ √© o CodeMind AI, especialista em completar c√≥digo.
Complete o c√≥digo fornecido de forma profissional e funcional.
Retorne o c√≥digo COMPLETO (n√£o apenas a parte faltante), come√ßando com <!DOCTYPE html>.`,

      convert: `Voc√™ √© o CodeMind AI, especialista em m√∫ltiplas linguagens.
Converta o c√≥digo conforme solicitado. Retorne apenas o c√≥digo convertido, limpo e funcional.`,

      docs: `Voc√™ √© o CodeMind AI, especialista em documenta√ß√£o.
Gere documenta√ß√£o completa em portugu√™s para o c√≥digo: README, coment√°rios JSDoc/inline, e explica√ß√£o de uso.`,

      chat: `Voc√™ √© o CodeMind AI, assistente s√™nior de desenvolvimento.
Responda em portugu√™s, seja direto e t√©cnico. Se gerar c√≥digo HTML, comece com <!DOCTYPE html>.`,
    };

    const sys = systemPrompts[mode] || systemPrompts.chat;
    const fullPrompt = `${sys}

PEDIDO DO USU√ÅRIO: ${prompt}

${code ? `C√ìDIGO NO EDITOR:\n\`\`\`html\n${code}\n\`\`\`` : ''}${filesContext}`;

    updateLoader('Conectando ao Gemini...', 'Inicializando modelo');
    const res = await callGemini(fullPrompt, mode);
    showLoading(false);

    const isCode = mode === 'build' || mode === 'fix' || mode === 'refactor' || mode === 'complete' || mode === 'convert';

    if (isCode && res.startsWith('<!DOCTYPE html')) {
      setCode(res);
      runPreview();
      addMessage('ai', '‚úÖ C√≥digo gerado com sucesso! Confira o editor e o preview ao lado.');
      addToHistory(prompt, res);
    } else if (isCode && res.includes('<!DOCTYPE html')) {
      const match = res.match(/<!DOCTYPE html[\s\S]*/i);
      if (match) {
        setCode(match[0]);
        runPreview();
        addMessage('ai', '‚úÖ C√≥digo extra√≠do e carregado no editor!');
        addToHistory(prompt, match[0]);
      } else {
        addMessage('ai', res);
      }
    } else {
      addMessage('ai', res);
    }

    document.getElementById('welcome').style.display = 'none';
  } catch (err) {
    showLoading(false);
    addMessage('error', `‚ùå Erro: ${err.message}`);
  }
}

// ===================== GEMINI API =====================
async function callGemini(prompt, mode) {
  updateLoader('Gerando c√≥digo...', 'Aguarde enquanto a IA trabalha');

  const response = await fetch(
    `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${apiKey}`,
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{ role: 'user', parts: [{ text: prompt }] }],
        generationConfig: {
          temperature: 0.7,
          maxOutputTokens: 8192,
        }
      })
    }
  );

  if (!response.ok) {
    const err = await response.json();
    throw new Error(err.error?.message || `HTTP ${response.status}`);
  }

  const data = await response.json();
  const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
  if (!text) throw new Error('Resposta vazia da API');

  // Remove markdown code blocks
  return text.replace(/```html\n?/gi, '').replace(/```\n?/g, '').trim();
}

// ===================== FILE HANDLING =====================
function handleFileSelect(input) {
  Array.from(input.files).forEach(readFile);
  input.value = '';
}

function handleFileDrop(e) {
  e.preventDefault();
  document.getElementById('drop-zone').classList.remove('drag-over');
  Array.from(e.dataTransfer.files).forEach(readFile);
}

function readFile(file) {
  const reader = new FileReader();
  reader.onload = (e) => {
    const obj = { name: file.name, content: e.target.result, size: file.size };
    uploadedFiles.push(obj);
    renderUploadedFiles();

    // Auto-load code files into editor
    const codeExts = ['html','css','js','ts','jsx','tsx','py','php','vue','svelte'];
    const ext = file.name.split('.').pop().toLowerCase();
    if (codeExts.includes(ext)) {
      setCode(e.target.result);
      showToast(`${file.name} carregado no editor!`, 'success');
      document.getElementById('welcome').style.display = 'none';
    }
    showToast(`${file.name} adicionado`, 'success');
    switchTab('files', null);
  };
  reader.readAsText(file);
}

function renderUploadedFiles() {
  const container = document.getElementById('uploaded-files');
  container.innerHTML = uploadedFiles.map((f, i) => `
    <div class="file-badge">
      <span>üìÑ</span>
      <span style="color:var(--text)">${f.name}</span>
      <span style="color:var(--dim);font-size:.58rem">${(f.size/1024).toFixed(1)}kb</span>
      <span class="remove" onclick="removeFile(${i})">‚úï</span>
    </div>
  `).join('');
}

function removeFile(i) {
  uploadedFiles.splice(i, 1);
  renderUploadedFiles();
  showToast('Arquivo removido');
}

// ===================== EDITOR =====================
function setCode(code) {
  document.getElementById('code-editor').value = code;
  updateLineCount();
}

function updateLineCount() {
  const lines = document.getElementById('code-editor').value.split('\n').length;
  document.getElementById('code-lines').textContent = `${lines} linhas`;
}

function runPreview() {
  const code = document.getElementById('code-editor').value;
  if (!code.trim()) return;
  const blob = new Blob([code], { type: 'text/html' });
  document.getElementById('preview-iframe').src = URL.createObjectURL(blob);
  document.getElementById('preview-status').textContent = '‚úÖ Rodando';
}

function formatCode() {
  const editor = document.getElementById('code-editor');
  let code = editor.value;
  // Basic indent cleanup
  try {
    const lines = code.split('\n');
    let indent = 0;
    const formatted = lines.map(line => {
      const trimmed = line.trim();
      if (!trimmed) return '';
      if (trimmed.match(/^<\/[^!]/)) indent = Math.max(0, indent - 1);
      const out = '  '.repeat(indent) + trimmed;
      if (trimmed.match(/^<[^/!][^>]*[^/]>$/) && !trimmed.match(/^<(br|hr|img|input|meta|link)/i)) indent++;
      return out;
    });
    editor.value = formatted.join('\n');
    updateLineCount();
    showToast('C√≥digo formatado!', 'success');
  } catch {
    showToast('N√£o foi poss√≠vel formatar', 'error');
  }
}

function copyCode() {
  const code = document.getElementById('code-editor').value;
  if (!code) return showToast('Nada para copiar', 'error');
  navigator.clipboard.writeText(code).then(() => showToast('C√≥digo copiado!', 'success'));
}

function downloadCode() {
  const code = document.getElementById('code-editor').value;
  if (!code) return showToast('Nada para baixar', 'error');
  const blob = new Blob([code], { type: 'text/html' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'codemind-output.html';
  a.click();
  showToast('Download iniciado!', 'success');
}

function openInTab() {
  const code = document.getElementById('code-editor').value;
  if (!code) return showToast('Nada para abrir', 'error');
  const blob = new Blob([code], { type: 'text/html' });
  window.open(URL.createObjectURL(blob), '_blank');
}

function clearAll() {
  if (!confirm('Limpar editor e preview?')) return;
  document.getElementById('code-editor').value = '';
  document.getElementById('preview-iframe').src = 'about:blank';
  document.getElementById('preview-status').textContent = '‚Äî';
  document.getElementById('welcome').style.display = 'flex';
  updateLineCount();
  showToast('Limpo!');
}

// ===================== VIEWS =====================
function setView(view, btn) {
  document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
  if (btn) btn.classList.add('active');
  const area = document.getElementById('output-area');
  area.className = `output-area ${view}-view`;
}

// ===================== TABS =====================
function switchTab(name, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  if (btn) btn.classList.add('active');
  else {
    document.querySelectorAll('.tab-btn').forEach(b => {
      if (b.textContent.toLowerCase().includes(name.substring(0,4))) b.classList.add('active');
    });
  }
  document.getElementById(`tab-${name}`)?.classList.add('active');
}

// ===================== CHAT UI =====================
function addMessage(type, text) {
  const log = document.getElementById('chat-log');
  const div = document.createElement('div');
  div.className = `msg msg-${type === 'user' ? 'user' : type === 'error' ? 'error' : type === 'system' ? 'system' : 'ai'}`;
  if (type === 'user') {
    div.innerHTML = `<div class="msg-label">VOC√ä</div>${escapeHtml(text)}`;
  } else if (type === 'ai') {
    div.innerHTML = `<div class="msg-label">‚ñ≤ CODEMIND</div>${text.replace(/\n/g, '<br>')}`;
  } else {
    div.textContent = text;
  }
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}

function escapeHtml(t) {
  return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function quickPrompt(text) {
  document.getElementById('user-input').value = text;
  document.getElementById('user-input').focus();
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

// ===================== HISTORY =====================
function addToHistory(prompt, code) {
  const item = { prompt, code, ts: new Date().toLocaleTimeString() };
  codeHistory.unshift(item);
  if (codeHistory.length > 20) codeHistory.pop();
  renderHistory();
}

function renderHistory() {
  const list = document.getElementById('history-list');
  list.innerHTML = codeHistory.map((item, i) => `
    <div class="tool-item" onclick="loadHistory(${i})">
      <div class="tool-icon" style="background:rgba(0,229,255,.1)">üìÑ</div>
      <div class="tool-info">
        <div class="tool-name">${item.ts}</div>
        <div class="tool-desc">${item.prompt.substring(0,40)}${item.prompt.length > 40 ? '...' : ''}</div>
      </div>
    </div>
  `).join('') || '<p style="font-size:.65rem;color:var(--dim);padding:12px">Sem hist√≥rico</p>';
}

function loadHistory(i) {
  setCode(codeHistory[i].code);
  runPreview();
  document.getElementById('welcome').style.display = 'none';
  showToast('Hist√≥rico carregado!', 'success');
}

// ===================== LOADING =====================
function showLoading(on) {
  isLoading = on;
  document.getElementById('loading').classList.toggle('active', on);
}

function updateLoader(text, step) {
  document.getElementById('loader-text').textContent = text;
  document.getElementById('loader-step').textContent = step;
}

// ===================== TOAST =====================
function showToast(msg, type = '') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `show ${type}`;
  setTimeout(() => t.className = '', 3000);
}

// ===================== INIT =====================
// Check for saved key
const savedKey = sessionStorage.getItem('cmKey');
if (savedKey) {
  document.getElementById('api-key').value = savedKey;
  apiKey = savedKey;
  document.getElementById('status-dot').classList.add('active');
  document.getElementById('status-label').textContent = 'Conectado';
}

document.getElementById('api-key').addEventListener('input', function() {
  sessionStorage.setItem('cmKey', this.value);
});

document.getElementById('mode-select').addEventListener('change', function() {
  currentTool = this.value;
});

updateLineCount();
</script>
</body>
</html>
